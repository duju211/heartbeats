---
title: "Heartrate"
author: "Julian During"
date: "27 12 2020"
output: 
  html_document: 
    theme: cosmo
    toc: yes
    number_sections: yes
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("libraries.R")
dir_ls("R") %>% 
  walk(
    ~ knitr::read_chunk(
      path = .x,
      labels = path_ext_remove(path_file(.x))))
```

# Idea

Explore heartrate data

# Data

## Activities with Heartrate

Get activities with heartrate data:

```{r act_raw}
```

Preprocess heartrate data:

```{r pre_process_act}
```

```{r, echo=FALSE}
readd(df_act)
```

## EDA Plots Activities {.tabset}

### Runs

```{r vis_eda_act_run}
```

```{r, echo=FALSE}
readd(gg_eda_act_run)
```

### Rides

```{r vis_eda_act_ride}
```

```{r, echo=FALSE}
readd(gg_eda_act_ride)
```

# Modeling {.tabset}

Set initial splits:

```{r eval=FALSE}
set.seed(123)
init_split <- initial_split(df_act, strata = average_heartrate)
bpm_train <- training(init_split)
bpm_test <- testing(init_split)
set.seed(234)
bpm_folds <- bootstraps(bpm_train, strata = average_heartrate)
```

## GLMNet

Define the workflow:

```{r glm_net_wf}
```

```{r}
readd(glm_net_workflow)
```

Tune the workflow:

```{r glm_net_tune_wf}
```

```{r include=FALSE}
loadd(glm_net_tune)
```

```{r, echo=FALSE}
glm_net_tune
```

Determine the best parameter set:

```{r}
show_best(glm_net_tune, metric = "rmse")
```


Fit the model one last time with the determined parameters:

```{r glm_net_last_fit}
```

Evaluate the performance:

```{r include=FALSE}
loadd(glm_net_fit)
```

```{r}
collect_metrics(glm_net_fit)
```

```{r}
readd(gg_glm_net_fit)
```

## Random Forest

Define the workflow:

```{r rf_wf}
```

```{r}
readd(rf_workflow)
```

Tune the workflow:

```{r rf_tune_wf}
```

```{r include=FALSE}
loadd(rf_tune)
```

```{r, echo=FALSE}
rf_tune
```

Determine the best parameter set:

```{r}
show_best(rf_tune, metric = "rmse")
```


Fit the model one last time with the determined parameters:

```{r rf_last_fit}
```

Evaluate the performance:

```{r include=FALSE}
loadd(rf_fit)
```

```{r}
collect_metrics(rf_fit)
```

```{r}
readd(gg_rf_fit)
```

# Variable Importance {.tabset}

```{r vis_vip}
```

## GLMNet

```{r, echo=FALSE}
readd(gg_glm_net_vip)
```

## Random Forest

```{r, echo=FALSE}
readd(gg_rf_vip)
```

# Save Model

```{r}
board_register_github(repo = "duju211/strava_act")

pin(rf_fit$.workflow[[1]], "rf_mod", board = "github")

board_disconnect("github")
```

